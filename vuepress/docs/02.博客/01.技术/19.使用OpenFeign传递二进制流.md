---
title: 使用OpenFeign传递二进制流
date: 2023-07-31 22:06:12
permalink: /pages/2023073103/
categories: 
  - 博客
  - BLOG
  - 技术
tags: 
  - OpenFeign
  - SpringBoot
author: 
  name: Soft1314
  link: https://github.com/soft1314
---
# 使用OpenFeign传递二进制流
在现代的分布式系统中，服务之间的通信变得越来越普遍。OpenFeign是一个流行的Java HTTP客户端工具，它简化了在微服务架构中进行服务间通信的过程，本文将简单介绍如何使用OpenFeign传递二进制流。 
## 什么是OpenFeign？ 
   OpenFeign是一个用于声明式、模板化的HTTP客户端的Java库。它简化了编写HTTP客户端的过程，使开发人员能够更轻松地与RESTful服务进行交互。OpenFeign支持多种注解和配置选项，可以轻松定义HTTP请求、路径参数、查询参数、请求体等。它还提供了负载均衡和服务发现的功能，可以与服务注册中心（如Eureka、Nacos）集成，以便在微服务架构中使用。OpenFeign是基于Netflix的Feign库开发的，它已经成为了Spring Cloud生态系统中常用的组件之一。
   OpenFeign是一个基于注解的声明式HTTP客户端工具，它可以与Spring Cloud等微服务框架无缝集成。它提供了一种简单和优雅的方式来定义和使用HTTP客户端，使得服务间通信变得更加容易。 
## 传递二进制流的需求 
   在一些场景中，我们需要传递二进制流数据，例如上传文件、下载文件、处理图片等。OpenFeign默认使用JSON作为数据传输格式，但对于二进制流数据，我们需要进行一些额外的配置和处理。 
## 开始正题 
### 上传
MultipartFile 是Spring框架中的一个接口，用于表示上传的文件。它提供了一些方法来获取文件的相关信息和内容。您可以使用 MultipartFile 来处理通过HTTP请求上传的文件数据。 
#### 服务端
```java
@RestController
public class DemoController {
  @PostMapping("/upload")
  @ApiOperation("上传文件")
  public void upload(@RequestParam("file") MultipartFile file) throws Exception {
    if (!file.isEmpty()) {
        try {
            // 处理上传的文件，例如保存到磁盘或进行其他操作
            byte[] fileBytes = file.getBytes();
            // 其他操作...
             return "文件上传成功";
        } catch (IOException e) {
            e.printStackTrace();
            return "文件上传失败";
        }
    } else {
        return "请选择要上传的文件";
    }
  }	
}
```
#### 客户端
- 声明接口
```java
@FeignClient
public interface IFeignRestService {
    @PostMapping(value = "/upload",consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
    ResultDTO upload(@RequestPart("file") MultipartFile file);
}
```
- 上传文件
```java
@RestController
public class UploadDemoController {
    @Resource
    private IFeignRestService feignRestService;

    @PostMapping("/upload")
    @ApiOperation("保存数据")
    public ResultDTO save(@RequestParam("file") MultipartFile file) throws Exception {
        return feignRestService.saveProcess(file,processCategory);
    }
}
```
### 下载
feign.Response  是 Feign 库中的一个类，用于表示 HTTP 响应。它提供了一些方法来获取响应的状态码、头部信息和响应体等内容。 
 在使用 Feign 进行服务间通信时，调用远程接口的方法可能会返回一个  feign.Response  对象，您可以通过该对象来获取远程服务的响应信息。 
#### 服务端
```java
@RestController
public class DemoController {
    @GetMapping(value = "/download")
    public void download(HttpServletResponse response) throws Exception {
        InputStream inputStream = ... //读取字节流
        byte[] b = new byte[1024];
        int len;
        while ((len = inputStream.read(b, 0, 1024)) != -1) {
            response.getOutputStream().write(b, 0, len);
        }
    }
}
```
#### 客户端
- 声明接口
```java
@FeignClient
public interface IFeignRestService {
    @GetMapping(value = "/download")
    feign.Response download() throws Exception;
}
``` 
- 下载文件
```java
    public void download(HttpServletResponse response) throws Exception {
        feign.Response feignResponse = null;
        InputStream inputStream = null;
        try {
            feignResponse = feignRestService.download(processInstanceId);
            inputStream = feignResponse.body().asInputStream();
            // 其他操作...
            inputStream.close();
        } catch (Exception e) {
            throw e;
        } finally {
            if (inputStream!=null){
                inputStream.close();
            }
        }
    }	
```
本文介绍了如何使用OpenFeign传递二进制流的技术细节和注意事项。通过合适的配置和使用，我们可以方便地在微服务架构中进行二进制流数据的传输，满足实际应用中的需求。 

--


**本文到此结束，感谢您的观看！！！**